<!DOCTYPE html>
<html lang="en" x-permissions="order_invoice_ui || order_invoice_manage" data-ng-app="myApp">

<head x-import="head.html">
    <style>
        body {
            margin-bottom: 50px;
            margin-top: 30px;
        }

        .order-invoice {
            padding: 5px !important;
            border: 1px solid #ffeb3b;
        }



        .item-groups {
            flex-flow: wrap;
            /* background-image: linear-gradient(rgb(255 217 0 / 38%), rgb(184 156 0 / 89%)); */
            overflow-x: auto;
            white-space: nowrap;
        }

        .item-groups::-webkit-scrollbar {
            height: 10px;
        }

        .item-groups::-webkit-scrollbar-thumb {
            border-radius: 13px;
            background-color: #5a47ff;
        }

        .item-groups::-webkit-scrollbar-thumb:hover {
            background: #2414ff;
        }

        .item-list,
        .item-types {
            display: inline-flex;
            flex-flow: wrap;
            padding: 9px;
            margin-bottom: 40px;

        }

        .item-groups .item {
            width: 130px;
            min-height: 80px;
            display: inline-flex;
            border: 1px solid #000000;
            background-color: #ffffff;
            text-align: center;
            /* border-top-right-radius: 25px; */
            border-top-left-radius: 25px;
        }

        .item-list .item,
        .item-types .item {
            width: 150px;
            display: inline-block;
            border: 2px solid #03008d;
            background-color: #ffffff;
            box-shadow: 3px 3px 3px 3px #9a96df;
            border-radius: 10px;
            text-align: center;
            margin: 13px !important;
        }

        .my-hover,
        .item-groups .item:hover {
            transform: scale(1.1);
            /* background-color: #57ff732e; */
            /* border: 2px solid rgb(58, 255, 124); */
            /* box-shadow: 3px 3px 3px 3px #36363638; */
            border-top-right-radius: 25px;
        }

        /* .item-groups .item :active {
            transform: scale(1.1);
            background-color: #ff2802e1;
            border: 2px solid rgb(74, 0, 248);
            box-shadow: 3px 3px 3px 3px #fd004ccc;
        } */

        .item-list .item:hover,
        .item-types .item:hover {
            transform: scale(1.1);
            /*  background-color: #57ff732e;
            border: 2px solid rgb(58, 255, 124); */
            box-shadow: 2px 2px 2px 2px #3431ebb0;
        }

        .item-types img,
        .item-list img {
            width: max-content;
            height: 90px;
            padding: unset;
            border-top-right-radius: 10px;
            border-top-left-radius: 10px;
            border-bottom-right-radius: unset;
            border-bottom-left-radius: unset;
            background-color: #ffffff;
        }


        /* .item-list img,
        .item-types img {
            background-color: #ffffff;
            border-radius: 10px;
        } */

        .bg_font_group {
            border-bottom-right-radius: 10px;
            border-bottom-left-radius: 10px;

        }


        .bg_font_item {
            background-image: linear-gradient(#3f51b5, #001fcec2);
            height: max-content;
            border-bottom-left-radius: 7px;
            border-bottom-right-radius: 7px;
        }

        .font_name_group {
            width: 190px;
            white-space: pre-line;
            display: inline-block;
            color: #ffffff;
            text-align: center;
            padding: 7px;
            font-weight: bold;
            height: 90px;
            text-shadow:
                3px 3px 0 #000,
                -1px -1px 0 #000,
                1px -1px 0 #000,
                -1px 1px 0 #000,
                1px 1px 0 #000;
        }

        .font_name_items {
            width: 190px;
            height: 50px;
            white-space: pre-line;
            display: inline-block;
            color: #ffffff;
            text-align: center;
            padding: 5px;
            font-weight: bold;

        }

        /* .item-list h2,
        .item-types h2 {
            width: 190px;
            display: inline-block;
            color: #030303;
            text-align: center;
            padding: 2px;
            font-weight: bold;
        }

        .item-groups h3 {
            width: 190px;
            display: inline-block;
            color: black;
            text-align: center;
            padding: 2px;
            font-weight: bold;
        }

        .item-list h3,
        .item-types h3 {
            width: 190px;
            display: inline-block;
            color: #23a30a;
            text-align: center;
            padding: 2px;
            font-weight: bold;
        } */


        .code,
        .code input {
            color: blue;
            font-weight: bold;
            font-size: 18px;
        }

        .btn {
            min-width: 200px;
        }

        .btn.saving {
            width: 200px;
            height: 100px;
            font-size: 22px;
            padding-top: 30px;
            background: #118011;
            font-weight: bold;
        }

        .btn.closing {
            width: 200px;
            height: 100px;
            font-size: 22px;
            padding-top: 30px;
            background: #e21212;
            font-weight: bold;
        }

        .btn.new,
        .btn.view {
            width: 150px;
            height: 50px;
            padding-top: 13px;
        }

        .modal-header {
            min-height: 35px;
        }
    </style>
</head>

<body class="##session.lang##">

    <nav x-import="sitebar/index.html" class="sitebar" data-ng-controller="sitebar">

    </nav>

    <nav class="sitebottom" x-import="sitebottom/index.html" ng-controller="sitebottom">

    </nav>

    <div id="main-layout" class="container loaded">
        <div class="row">
            <div class="row" ng-controller="order_invoice">
                <div x-permissions="order_invoice_add || order_invoice_manage"
                    x-import="order-invoice/order_invoices_active.html">
                </div>
                <div x-permissions="order_invoice_add || order_invoice_manage" x-import="customers/add_modal.html">
                </div>
                <div x-permissions="order_invoice_add || order_invoice_manage"
                    x-import="order-invoice/delivery_service.html">
                </div>
                <div x-permissions="order_invoice_add || order_invoice_manage"
                    x-import="order-invoice/select_table.html">
                </div>
                <div x-permissions="order_invoice_add || order_invoice_manage"
                    x-import="order-invoice/merge_tables.html">
                </div>
                <!--  <div x-permissions="order_invoice_add || order_invoice_manage"
                    x-import="order-invoice/change_item_count.html">
                </div> -->
                <div x-permissions="order_invoice_add || order_invoice_manage"
                    x-import="order-invoice/account_invoice.html">
                </div>

                <div x-permissions="order_invoice_update || order_invoice_manage"
                    x-import="order-invoice/update_modal.html"></div>
                <div x-permissions="order_invoice_delete || order_invoice_manage"
                    x-import="order-invoice/delete_modal.html"></div>
                <div x-permissions="order_invoice_view || order_invoice_manage"
                    x-import="order-invoice/view_modal.html"></div>
                <div x-import="order-invoice/items_modal.html"></div>
                <div x-permissions="order_invoice_search || order_invoice_manage"
                    x-import="order-invoice/search_all_modal.html"></div>
                <div x-import="accounting-invoices/add_payments_modal.html"></div>

                <div class="row">

                    <!-- style="background-color: {{g.color}};" -->

                    <div class="col6">

                        <div class="row">
                            <i-button type="bg-green" label="##word.new_order##" ng-click="newOrderInvoice()">
                            </i-button>

                            <i-button type="bg-blue" label="##word.open_orders##" ng-click="viewInvoicesActiveList()">
                            </i-button>

                            <i-button x-permissions="order_invoice_cancel_order || order_invoice_manage" type="bg-red"
                                label="##word.cancel_order##" ng-click="cancelOrderInvoice()">
                            </i-button>
                        </div>

                        <br>
                        <br>

                        <div class="row">
                            <div class="item-groups">
                                <a class="item pointer center" style="background-color: {{g.color}};"
                                    ng-repeat="g in itemsGroupList" ng-click="loadItems(g , $event)"
                                    help-id="menu_monitor">
                                    <!-- <img ng-src="{{g.image_url}}"> -->
                                    <p class="center font_name_group">{{g.name_##session.lang##}}</p>
                                </a>
                            </div>
                            <hr style="height:7px;background-image:linear-gradient(rgb(90 79 255), rgb(227 225 255));">
                        </div>

                        <div class="row">
                            <div class="item-list" ng-show="itemsList.length > 0">
                                <a class="item pointer" ng-repeat="i in itemsList" ng-click="showItemsIn(i)"
                                    help-id="menu_monitor">
                                    <img ng-src="{{i.image_url}}">
                                    <div class="bg_font_item">
                                        <p class="center font_name_items">{{i.name_##session.lang##}}</p>
                                    </div>
                                </a>
                            </div>
                        </div>

                        <br>

                        <div id="sizesModal" class="modal small">

                            <div class="modal-content">
                                <div class="modal-header">
                                    <span class="close">&times;</span>
                                </div>

                                <div class="modal-body">
                                    <div class="item-types center">
                                        <a class="item pointer center" ng-repeat="s in current_items.sizes"
                                            ng-click="bookList(s)" help-id="menu_monitor">
                                            <img ng-src="{{s.image_url}}" onerror="this.src='/images/no.png'">
                                            <!-- <h3> ##word.price## : {{s.price}}</h3> -->
                                            <div class="bg_font_item">
                                                <h3 class="center font_name_items">{{s.size_ar}}</h3>
                                            </div>
                                        </a>

                                    </div>
                                </div>

                                <div class="modal-footer center">
                                    <i-button type="close" label="##word.close##"
                                        onclick="site.hideModal('#sizesModal')"> </i-button>
                                </div>
                            </div>

                        </div>

                    </div>

                    <div class="col6 order-invoice">
                        <div class="row" ng-hide="'##user.type##' == 'table'">
                            <div class="row ">
                                <h2 class="bold center red">{{error}}</h2>

                                <div class="row">
                                    <i-date2 class="col6" ng-model="order_invoice.date" label="##word.date##"></i-date2>

                                    <i-control class="col3 r_indigo" disabled label="##word.shift##"
                                        ng-model="shift.name_##session.lang##"></i-control>

                                    <i-control ng-hide="disabledCode" class="col3" disabled label="##word.code##"
                                        ng-model="order_invoice.code"></i-control>

                                </div>

                                <div class="row">

                                    <i-list ng-search="_search.$transaction_type" class="col4"
                                        display="##session.lang##" ng-model="order_invoice.transaction_type"
                                        label="##word.transaction_type##" items="transactionTypeList"
                                        ng-change="calc(order_invoice)">
                                    </i-list>
                                    <i-button ng-show="order_invoice.transaction_type.id == 1 && order_invoice.id"
                                        type="bg-blue" label="##word.merge_table##" ng-click="viewInvoicesTablesList()">
                                    </i-button>
                                    <i-list ng-show="order_invoice.transaction_type.id == 2"
                                        ng-search="_search.$order_invoice_employee" class="col4" display="name_##session.lang##"
                                        ng-model="order_invoice.delivery_employee" label="##word.delivery_employee##"
                                        items="deliveryEmployeesList"></i-list>
                                </div>

                                <div class="row" ng-show="order_invoice.transaction_type.id == 1">
                                    <i-button type="bg-blue" label="##word.select_table##" ng-click="showTable()">
                                    </i-button>
                                    <i-control class="col4" ng-model="order_invoice.table.name_##session.lang##" label="##word.table##"
                                        type="text" disabled></i-control>
                                    <i-control class="col2" ng-model="order_invoice.count_person"
                                        label="##word.count_person##" type="number"></i-control>
                                    <i-control class="col2" ng-model="order_invoice.service" label="##word.service##"
                                        type="number" ng-change="calc(order_invoice)"></i-control>
                                </div>
                                <div class="row">
                                    <div class="row">
                                        <i-button type="add" label="##word.customers_new##"
                                            ng-click="displayAddCustomer()">
                                        </i-button>

                                        <i-control ng-keydown="getCustomerList($event)" id="service" class="col3"
                                            ng-model="search_customer" label="##word.search##" type="text"></i-control>

                                        <i-list ng-search="_search.$order_customers" class="col5"
                                            display="name_##session.lang##" ng-model="order_invoice.customer"
                                            label="##word.customer_name##"
                                            ng-change="changeCustomerAddresses(order_invoice.customer)"
                                            items="customersList">
                                        </i-list>

                                    </div>
                                    <fieldset ng-show="order_invoice.transaction_type.id == 2">
                                        <legend> ##word.customer_data##</legend>
                                        <div class="row">
                                            <div class="row">

                                                <i-list class="col3" label="##word.customers_gov##"
                                                    ng-model="order_invoice.gov" items="govList" display="name_##session.lang##"
                                                    ng-change="getCityList(order_invoice.gov)"
                                                    ng-search="_search.$govNameContact"></i-list>

                                                <i-list class="col3" label="##word.city##" ng-model="order_invoice.city"
                                                    items="cityList" ng-change="getAreaList(order_invoice.city)"
                                                    display="name_##session.lang##" ng-search="_search.$order_invoice_city_search">
                                                </i-list>

                                                <i-list class="col3" label="##word.area##" ng-model="order_invoice.area"
                                                    items="areaList" display="name_##session.lang##"
                                                    ng-change=" order_invoice.price_delivery_service = order_invoice.area.price_delivery_service"
                                                    ng-search="_search.$order_invoice.$area_search"></i-list>

                                                <i-control ng-show="order_invoice.transaction_type.id == 2"
                                                    ng-model="order_invoice.price_delivery_service"
                                                    label="##word.price_delivery_service##"
                                                    ng-change="calc(order_invoice)" class="col3" type="number">
                                                </i-control>

                                            </div>

                                            <div class="row">

                                                <i-control class="col8" label="##word.customers_address##"
                                                    ng-model="order_invoice.address"></i-control>

                                                <i-control class="col4" label="##word.customers_mobile##"
                                                    ng-model="order_invoice.customer_mobile">
                                                </i-control>

                                            </div>

                                        </div>
                                    </fieldset>
                                </div>

                            </div>
                        </div>
                        <br>
                        <div class="row ">

                            <table class="table bold hover loaded" id="t1">

                                <tr>
                                    <th>##word.stores_items_name##</th>
                                    <th>##word.stores_size##</th>
                                    <th class="w150">##word.items_count##</th>
                                    <th>##word.price##</th>
                                    <th class="w100">##word.t_o## ##word.price##</th>
                                    <th class="not-print">##word.actions##</th>
                                </tr>

                                <tr ng-repeat="size in order_invoice.book_list">
                                    <td class="center title">{{size.name_##session.lang##}}</td>
                                    <td class="center title">
                                        <p>{{size.size_ar}}</p>
                                        <p>{{size.size_en}}</p>
                                    </td>
                                    <td class="center">
                                        <i-control ng-change="calcSize(size)" ng-model="size.count" type="number">
                                        </i-control>
                                    </td>
                                    <td class="center blue">
                                        <br ng-hide="size.discount.value > 0">
                                        <p class="center">{{size.price}}</p>

                                        <del class="red px14"
                                            ng-show="size.discount.type =='number' && size.discount.value > 0">{{size.discount.value}}
                                            $</del>
                                        <del class="red px14"
                                            ng-show="size.discount.type =='percent' && size.discount.value > 0">{{size.discount.value}}
                                            %</del>
                                    </td>

                                    <td class="center green"><br> {{size.total}}</td>

                                    <!-- ng-hide="'##user.type##' == 'table'" -->
                                    <td class="center not-print">
                                        <i-button type="edit default" ng-click="showEditItem(size)"></i-button>

                                        <i-button type="delete default"
                                            x-permissions="order_invoice_delete_items || order_invoice_manage"
                                            ng-click="deleteItemsList(size) ; calcSize(size)">
                                        </i-button>

                                    </td>
                                </tr>

                            </table>
                        </div>

                        <div id="editItemModal" class="modal small">

                            <div class="modal-content">
                                <div class="modal-header">
                                    <span class="close">&times;</span>
                                </div>

                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col2"></div>
                                        <div class="col8">

                                            <div class="row">

                                                <i-list ng-model="size_edit.unit" class="col6" label="##word.unit##"
                                                    ng-change="ChangeUnitPatch(size_edit);"
                                                    ng-search="_search.$category_item.$unit_search" space=" - "
                                                    display2="barcode" items="size_edit.size_units_list">
                                                </i-list>

                                                <div class="col4">

                                                    <i-control type="number" label="##word.discount##"
                                                        ng-change="calcSize(size_edit)"
                                                        ng-model="size_edit.discount.value">
                                                    </i-control>

                                                    <div class="row center">
                                                        <i-radio ng-model="size_edit.discount.type"
                                                            ng-click="calcSize(size_edit)"
                                                            label="##word.discount_types_number##" ng-value="number"
                                                            group="type" type="radio"></i-radio>
                                                        <i-radio ng-model="size_edit.discount.type"
                                                            ng-click="calcSize(size_edit)"
                                                            label="##word.discount_types_percent##" ng-value="percent"
                                                            group="type" type="radio"></i-radio>
                                                    </div>

                                                </div>

                                            </div>

                                            <div class="row">
                                                <i-textarea label="##word.notes##" class="col10"
                                                    ng-model="size_edit.notes">
                                                </i-textarea>

                                            </div>
                                        </div>

                                    </div>

                                </div>

                                <div class="modal-footer center">
                                    <i-button type="close" label="##word.close##"
                                        onclick="site.hideModal('#editItemModal')"> </i-button>
                                </div>
                            </div>

                        </div>

                        <div class="row">
                            <h2 class="bold center red">{{error}}</h2>
                        </div>

                        <div class="row" ng-hide="'##user.type##' == 'table'">

                            <div class="col6 padding margin">
                                <table class="table box-shadow " ng-init="discountEditorAdd = true">
                                    <tr>
                                        <th colspan="2" class="pointer"
                                            ng-click="discountEditorAdd = !discountEditorAdd">
                                            ##word.discountes##
                                            <i class="fa fa-edit"></i>
                                        </th>
                                    </tr>
                                    <tr ng-hide="discountEditorAdd">
                                        <td colspan="2">
                                            <form>

                                                <div class="row ">
                                                    <i-list class="col4" ng-model="discount" display="name_##session.lang##"
                                                        ng-search="_search.$discount_name" items="discount_types"
                                                        label="##word.discount_name##">
                                                    </i-list>
                                                </div>

                                                <div class="row">
                                                    <i-control class="col4" ng-model="discount.value" type="number"
                                                        label="##word.discount_value##"></i-control>
                                                    <div class="col4">
                                                        <i-radio ng-model="discount.type" ng-value="number" group="type"
                                                            label="##word.discount_types_number##">
                                                        </i-radio>

                                                        <i-radio ng-model="discount.type" group="type"
                                                            ng-value="percent" label="##word.discount_types_percent##">
                                                        </i-radio>
                                                    </div>
                                                    <div class="col4" class="padding">
                                                        <br>
                                                        <i-button ng-click="addDiscount() ;calc(order_invoice)"
                                                            label="##word.stores_out_add_discount##" type="add default">
                                                        </i-button>
                                                    </div>

                                                </div>


                                            </form>
                                        </td>
                                    </tr>

                                    <tr ng-repeat="d1 in order_invoice.discountes">

                                        <td>
                                            <span class="bold red">{{d1.name_##session.lang##}} -</span>
                                            <span class="bold red" ng-show="d1.type === 'percent'">{{d1.value}}
                                                %</span>
                                            <span class="bold red" ng-show="d1.type === 'number'">{{d1.value}}$</span>
                                            <i-button type="delete" ng-click="deleteDiscount(d1) ; calc(order_invoice)">
                                            </i-button>
                                        </td>

                                    </tr>
                                </table>

                            </div>

                            <div class="col5 padding margin">
                                <table class="table box-shadow " ng-init="taxEditorAdd = true">

                                    <tr>
                                        <th colspan="2" class="pointer" ng-click="taxEditorAdd = !taxEditorAdd">
                                            ##word.stores_out_taxes##
                                            <i class="fa fa-edit"></i>
                                        </th>
                                    </tr>

                                    <tr ng-hide="taxEditorAdd">
                                        <td colspan="2">
                                            <div class="row">
                                                <i-list class="col6" ng-model="tax" label="##word.discount_name##"
                                                    ng-search="_search.$taxtypes" items="tax_types"></i-list>
                                            </div>
                                            <div class="row">
                                                <i-control class="col4" ng-model="tax.value"
                                                    label="##word.discount_value##">
                                                </i-control>
                                                <div class="col5 padding">
                                                    <br>
                                                    <i-button type="add default" label="##word.stores_out_add_tax##"
                                                        ng-click="addTax() ;calc(order_invoice)">
                                                    </i-button>

                                                </div>
                                            </div>
                                        </td>
                                    </tr>

                                    <tr ng-repeat="tx in order_invoice.taxes">
                                        <td>
                                            <span class="bold red">{{tx.name_##session.lang##}} -</span>
                                            <span class="bold red">{{tx.value}} %</span>
                                            <i-button type="delete" ng-click="deleteTax(tx) ;calc(order_invoice)">
                                            </i-button>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col8">

                                <div class="row">
                                    <i-control class="col4" ng-model="order_invoice.total_discount"
                                        label="##word.stores_out_total_discount##" type="number" disabled></i-control>
                                    <i-control class="col4" ng-model="order_invoice.total_tax"
                                        label="##word.stores_out_total_tax##" type="number" disabled></i-control>
                                    <i-control class="col4" ng-model="order_invoice.total_value"
                                        label="##word.total_value##" type="number" disabled></i-control>
                                </div>

                                <div class="row">

                                    <i-control class="col6" ng-model="order_invoice.net_value"
                                        label="##word.net_value##" type="number" disabled></i-control>

                                </div>

                                <i-button
                                    ng-show="defaultSettings.accounting.create_invoice_auto && order_invoice.status.id == 2 && !order_invoice.invoice"
                                    type="save" label="##word.create_an_invoice##"
                                    ng-click="displayAccountInvoice(order_invoice)">
                                </i-button>

                                <i-button ng-hide="'##user.type##' == 'table'" class="not-print"
                                    label="##word.print_invoice##" type="print "
                                    ng-click="printAccountInvoive(order_invoice)">
                                </i-button>
                            </div>

                            <div class="col4" ng-hide="order_invoice.status.id == 2">
                                <i-button label="##word.add_to_orders##" type="fa fa-cart-plus saving"
                                    ng-click="addOrderInvoice()">
                                </i-button>
                                <br>
                                <i-button type="closing"
                                    ng-hide="order_invoice.active == false || '##user.type##' == 'table'"
                                    label="##word.close_order##" ng-click="closeOrder()">
                                </i-button>
                            </div>

                        </div>
                    </div>

                </div>

            </div>
            <div class="top-actions">

            </div>

        </div>
    </div>

    <div x-import="scripts.html"></div>
    <script x-import="order-invoice/index.js"></script>
</body>

</html>